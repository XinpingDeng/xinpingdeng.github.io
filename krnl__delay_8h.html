<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>gxcorr: /data/BALDR_1/den15c/gxcorr/gxcorr/krnl_delay.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">gxcorr
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_61fa3639f67dbf40431b13d81e35ca34.html">gxcorr</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">krnl_delay.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;<a class="el" href="gxcorr__utils_8h_source.html">gxcorr_utils.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="gxcorr__constants_8h_source.html">gxcorr_constants.h</a>&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for krnl_delay.h:</div>
<div class="dyncontent">
<div class="center"><img src="krnl__delay_8h__incl.png" border="0" usemap="#a_2data_2BALDR__1_2den15c_2gxcorr_2gxcorr_2krnl__delay_8h" alt=""/></div>
<map name="a_2data_2BALDR__1_2den15c_2gxcorr_2gxcorr_2krnl__delay_8h" id="a_2data_2BALDR__1_2den15c_2gxcorr_2gxcorr_2krnl__delay_8h">
<area shape="rect" title=" " alt="" coords="39,5,234,47"/>
<area shape="rect" href="gxcorr__utils_8h.html" title=" " alt="" coords="5,95,116,121"/>
<area shape="rect" href="gxcorr__constants_8h.html" title=" " alt="" coords="140,95,285,121"/>
<area shape="rect" title=" " alt="" coords="7,169,114,196"/>
</map>
</div>
</div>
<p><a href="krnl__delay_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a5028b384cca687236478236faf2bd885"><td class="memItemLeft" align="right" valign="top">__global__ void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="krnl__delay_8h.html#a5028b384cca687236478236faf2bd885">krnl_delay</a> (double *delay_coeff, double lo, double tsamp, int nchan, int nfft, int nsamp_per_frame, int ntime_extra, double cal_phase0, double cal_freq, double tstart, int8_t *frame_invalid, float *phase_rotation, int *sample_shift, float *frac_delay, int8_t *cal_status, int8_t *fft_valid)</td></tr>
<tr class="memdesc:a5028b384cca687236478236faf2bd885"><td class="mdescLeft">&#160;</td><td class="mdescRight">CUDA implementation to get delay corrections.  <a href="krnl__delay_8h.html#a5028b384cca687236478236faf2bd885">More...</a><br /></td></tr>
<tr class="separator:a5028b384cca687236478236faf2bd885"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a id="a5028b384cca687236478236faf2bd885"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5028b384cca687236478236faf2bd885">&#9670;&nbsp;</a></span>krnl_delay()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">__global__ void krnl_delay </td>
          <td>(</td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>delay_coeff</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>lo</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>tsamp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nchan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nfft</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nsamp_per_frame</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>ntime_extra</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>cal_phase0</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>cal_freq</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>tstart</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int8_t *&#160;</td>
          <td class="paramname"><em>frame_invalid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float *&#160;</td>
          <td class="paramname"><em>phase_rotation</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>sample_shift</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float *&#160;</td>
          <td class="paramname"><em>frac_delay</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int8_t *&#160;</td>
          <td class="paramname"><em>cal_status</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int8_t *&#160;</td>
          <td class="paramname"><em>fft_valid</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>CUDA implementation to get delay corrections. </p>
<p>It calculates</p><ol type="1">
<li>delay corrections (currently assuming that we have 5th order poly), including phase rotation correction and integer sample shift which can be applied in time domain, fractional sample correction which should be applied in frequency domain,</li>
<li>noise calibration phase</li>
<li>fft validation</li>
</ol>
<p>The current implementation of </p><dl class="section see"><dt>See also</dt><dd><a class="el" href="krnl__delay_8h.html#a5028b384cca687236478236faf2bd885" title="CUDA implementation to get delay corrections.">krnl_delay</a> assumes that fine frequency channels are in an ascending order, but the implementation of </dd>
<dd>
<a class="el" href="krnl__cross_8h.html#a3d50b12ea410d3ecc06752b32386c86d" title="CUDA implementation of cross correlation with FFT validation markers and delay corrections.">krnl_cross</a> assume that fine frequency channels need a fftshift</dd></dl>
<p>To setup kernel on host, blockDim.x and gridDim.x are used to define number of FFTs <em>nfft</em>, where blockDim.x is number of threads (<em>nthread</em>) per CUDA thread block and gridDim.x is <code>nfft/nthread</code>. gridDim.y is number of antennas <em>nant</em> </p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Kernel dims   </th><th class="markdownTableHeadNone">Value    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">gridDim.y   </td><td class="markdownTableBodyNone">nant    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">gridDim.x   </td><td class="markdownTableBodyNone">nfft/nthread    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">blockDim.x   </td><td class="markdownTableBodyNone">nthread   </td></tr>
</table>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">delay_coeff</td><td>Delay coefficient given by the telescope, it is in the order [NANT NDATA], where <code>NDATA</code> is number of coefficiency (5th oder poly has 6 coefficient) plus one for poly timestamp in seconds The first number is poly timestamp in seconds The coefficiency are in microseconds, where a antenna which receives signal first has negative delay. <br  />
 The coefficiency has n+1 values, where n is the poly order.</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">lo</td><td>Frequency in Hz </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">tsamp</td><td>Sampling time in microseconds </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">nchan</td><td>Number of channels </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">cal_phase0</td><td>The start phase for noise calibration phase calculation. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">cal_freq</td><td>Noise calibration frequency in Hz. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">tstart</td><td>The start time in seconds of current buffer block, it is the real start time WITHOUT the overlap </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ntime_extra</td><td>Extra time stamps at one side for each antenna/polarisation </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">frame_invalid</td><td>Frame invalidation markers of all frames in the current buffer block, it is in order of [NANT NPOL NFRAME] </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">nsamp_per_frame</td><td>Number of samples of each CODIF data frame.</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">phase_rotation</td><td>Calculated phase rotation coefficient, which will be used to correct phase rotation in time domain by unpack kernel </td></tr>
  </table>
  </dd>
</dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="krnl__unpack_8h.html#a2beae8983b819f31ae701ac2019d6a7c">krnl_unpack</a>. The rotation is different in frequency channels, the array has linear interpolation coefficiency for each antenna and FFT. Downstream kernels has to do interpolation to figure out the rotation at each frequency channel. It is in order [NANT NFFT 2], where 2 is two numbers. </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">sample_shift</td><td>Calculated integer sample shifts, which is used as sample index shift in time domain by unpack kernel </td></tr>
  </table>
  </dd>
</dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="krnl__unpack_8h.html#a2beae8983b819f31ae701ac2019d6a7c">krnl_unpack</a>. The delay is the same for all frequency channels of each FFT. It is in order [NANT NFFT] </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">frac_delay</td><td>Calculated fractional sample delay, which will be used to correct fractional phase rotation in frequency domain by cross correlation kernel </td></tr>
  </table>
  </dd>
</dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="krnl__cross_8h.html#a3d50b12ea410d3ecc06752b32386c86d" title="CUDA implementation of cross correlation with FFT validation markers and delay corrections.">krnl_cross</a>. The delay is different from channel to channel, we provide radians per channel for cross correlation kernel to use </dd>
<dd>
<a class="el" href="krnl__cross_8h.html#a3d50b12ea410d3ecc06752b32386c86d" title="CUDA implementation of cross correlation with FFT validation markers and delay corrections.">krnl_cross</a> It is in order [NANT NFFT] </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">cal_status</td><td>Calculated noise calibration status of each FFT, true for on and false for off, it is the same for two polarisations of all antennas. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">fft_valid</td><td>FFT validation markers, it is in order [NANT NPOL NFFT] </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
